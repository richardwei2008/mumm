<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>填写联系方式</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <meta content="telephone=no" name="format-detection"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>

    <link href="../css/jquery.mobile-1.4.3.css" rel="stylesheet" type="text/css"/>
    <link href="../css/jquery.mobile.customize-1.4.3.css" rel="stylesheet" type="text/css"/>
    <link href="../css/app.css" rel="stylesheet" type="text/css"/>

    <script src="../js/json2.js" type="text/javascript"></script>
    <script src="../js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="../js/jquery.serializejson-2.1.0.min.js" type="text/javascript"></script>
    <script src="../js/jquery.mobile-1.4.3.min.js" type="text/javascript"></script>
    <script src="../js/beyond.wechat.share-0.1.1.js" type="text/javascript"></script>
    <script src="../js/app-1.0.js" type="text/javascript"></script>

    <script type="text/javascript">
        var App = {
            submit : function() {
                var cellphone = $("#cellphone").val();
                var pubCode = $("#pubCode").val();
                var contactName = $("#contactName").val();
                var email = $("#email").val();
                if ($.isEmptyObject(cellphone) || cellphone.length !== 11) {
                    $("#errorMsg").html("请完整输入11位手机号码：（XXX-XXXX-XXXX）");
                    $.mobile.changePage('#error', {transition: 'pop', role: 'dialog'});
                    return;
                }
                if ($.isEmptyObject(pubCode)) {
                    $("#errorMsg").html("请正确填写酒吧识别码！");
                    $.mobile.changePage('#error', {transition: 'pop', role: 'dialog'});
                    return;
                }
                if (!$.isEmptyObject(contactName) && contactName.length > 50) {
                    $("#errorMsg").html("联系人超长，请重新填写");
                    $.mobile.changePage('#error', {transition: 'pop', role: 'dialog'});
                    return;
                }
                if (!$.isEmptyObject(email) && email.length > 50) {
                    $("#errorMsg").html("联系方式超长，请重新填写");
                    $.mobile.changePage('#error', {transition: 'pop', role: 'dialog'});
                    return;
                }
                $.ajax({
                    async : false,
                    type : "POST",
                    url: "../services/CashService.php",
                    contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                    timeout : 1000,
                    datatype : "json",
                    data: JSON.stringify({method : "POST",
                        openid: null,
                        cellphone : cellphone,
                        name : contactName,
                        address : '',
                        mail : email,
                        pubCode : pubCode.toUpperCase()}),
                    success : function(response) {
                        if (response.success) {
                            window.location.href = window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/mumm.html";
                        } else {
                            switch (response.code) {
                                case 'E001':
                                case 'E002':
                                case 'E003':
                                case 'E004':
                                case 'E005':
                                    $("#errorMsg").html(response.message);
                                    break;
                                default :
                                    $("#errorMsg").html("未知错误，请联系工作人员—" + JSON.stringify(response));
                                    break;
                            }
                            $.mobile.changePage('#error', {transition: 'pop', role: 'dialog'});
                        }
                    },
                    error : function (xhr, textStatus, errorThrown) {
                        if (!$.isEmptyObject(xhr)) {
                            $("#fatalMsg").html(xhr.responseText);
                        } else {
                            $("#fatalMsg").html(errorThrown);
                        }
                        $.mobile.changePage('#fatal', {transition: 'pop', role: 'dialog'});
                    }
                })
            }
        }
        $(window).ready(function () {
//            $("#submitBtn").click(function() {
//                window.location.href = window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/mumm.html";
//            });
            $("#submitBtn").unbind('click').bind("click", App.submit);
            $("#errorClose").unbind('click').bind("click", function() {
                $('#error').dialog('close');
                window.location.href = window.location.href;
            });
            $("#fatalClose").unbind('click').bind("click", function() {
                $('#fatal').dialog('close');
                window.location.href = window.location.href;
            });
        });
    </script>
</head>
<body style="background:#000;">
<div data-role="page" id="cashLotteryPage">
    <div data-role="content" data-position="fixed">
        <div align="center"><img src="../images/top_cell.jpg" width="100%" border="0" hspace="0" vspace="0"/>
        </div>
        <div id="swap_9363" class="e-wrap template-style-10">
            <div class="e-sect rich-text" style="background:url(../images/bg.jpg) center no-repeat; background-size: 100% 100%; height:1020px;">
                <div class="e-widget-box">
                    <div class="e-widget-title" style="display:none;"></div>
                    <div class="e-widget-content">
                        <p style="text-align:center;">
                        <table width="286" border="0" align="center" cellpadding="0" cellspacing="5">
                            <tr>
                                <td width="99"><div class="ui-input-label-customized" align="right">联系人：</div></td>
                                <td width="172"><input id="contactName" type="text" class="ui-input-text-customized"
                                                       maxlength="50"/></td>
                            </tr>
                            <tr>
                                <td><div  class="ui-input-label-customized" align="right">联系方式：</div></td>
                                <td><input id="cellphone" type="text" class="ui-input-text-customized"
                                           minlength="11" maxlength="11" required/></td>
                            </tr>
                            <tr>
                                <td><div  class="ui-input-label-customized" align="right">联系邮箱：</div></td>
                                <td><input id="email" type="text" class="ui-input-text-customized"
                                           maxlength="50"/></td>
                            </tr>
                            <tr>
                                <td><div  class="ui-input-label-customized"  align="right">酒吧识别码：</div></td>
                                <td><input id="pubCode" type="text" class="ui-input-text-customized" style="text-transform: uppercase!important;"
                                           minlength="3" maxlength="8" required/></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td><button id="submitBtn" class="ui-btn ui-corner-all ui-btn-inline ui-btn-l-customized" data-mini="true" data-inline="true"
                                        >提      交</button></td>
                            </tr>
                            <tr>
                                <td colspan="2"><img src="../images/wine.png" width="280" height="195"/></td>
                            </tr>
                        </table>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <div data-role="page" id="error" data-dismissible="false" data-close-btn="right"  class="ui-dialog-background-customized">
        <div data-role="header">
            <h1><span class="label label-danger">错误</span></h1>
        </div>
        <div data-role="content" class="ui-dialog-content-background-customized">
            <div class="ui-dialog-message-customized">
                <p><span id="errorMsg" class="ui-input-label-customized"></span></p>
            </div>
            <button id="errorClose" class="ui-btn ui-shadow ui-corner-all ui-btn-customized" data-mini="true" data-inline="true">关    闭</button>
        </div>
    </div>
    <div data-role="page" id="fatal" data-dismissible="false" data-close-btn="right" class="ui-dialog-background-customized">
        <div data-role="header">
            <h1><span class="label label-danger">严重错误</span></h1>
        </div>
        <div data-role="content" class="ui-dialog-content-background-customized">
            <div class="ui-dialog-message-customized">
                <p><span id="fatalMsg" class="ui-input-label-customized"></span></p>
            </div>
            <button id="fatalClose" class="ui-btn ui-shadow ui-corner-all ui-btn-customized" data-mini="true" data-inline="true">关    闭</button>
        </div>
    </div>

</body>
</html>